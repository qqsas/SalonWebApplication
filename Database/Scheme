CREATE DATABASE IF NOT EXISTS SalonDB;
USE SalonDB;

CREATE TABLE User (
    UserID INT(11) NOT NULL AUTO_INCREMENT,
    Name VARCHAR(100) NOT NULL,
    Email VARCHAR(100) NOT NULL,
    Number VARCHAR(20) NOT NULL,
    Password VARCHAR(255) NOT NULL,
    Role VARCHAR(50) NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (UserID)
);

CREATE TABLE Admin (
    BarberID INT(11) NOT NULL AUTO_INCREMENT,
    UserID INT(11) NOT NULL,
    Name VARCHAR(100) NOT NULL,
    Bio TEXT DEFAULT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (BarberID),
    INDEX idx_userid (UserID),
    FOREIGN KEY (UserID) REFERENCES User(UserID)
);

CREATE TABLE Barber (
    BarberID INT(11) NOT NULL AUTO_INCREMENT,
    UserID INT(11) NOT NULL,
    Name VARCHAR(100) NOT NULL,
    Bio TEXT DEFAULT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (BarberID),
    UNIQUE KEY uniq_userid (UserID),
    FOREIGN KEY (UserID) REFERENCES User(UserID)
);

CREATE TABLE Services (
    ServicesID INT(11) NOT NULL AUTO_INCREMENT,
    Name VARCHAR(100) NOT NULL,
    Description TEXT DEFAULT NULL,
    Price DECIMAL(10,2) NOT NULL,
    Time INT(11) NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (ServicesID)
);

CREATE TABLE BarberServices (
    BarberServiceID INT(11) NOT NULL AUTO_INCREMENT,
    BarberID INT(11) NOT NULL,
    ServicesID INT(11) NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (BarberServiceID),
    UNIQUE KEY uniq_barber_service (BarberID, ServicesID),
    FOREIGN KEY (BarberID) REFERENCES Admin(BarberID),
    FOREIGN KEY (ServicesID) REFERENCES Services(ServicesID)
);

CREATE TABLE BarberWorkingHours (
    BarberID INT(11) NOT NULL,
    DayOfWeek INT(11) NOT NULL,
    StartTime TIME NOT NULL,
    EndTime TIME NOT NULL,
    PRIMARY KEY (BarberID, DayOfWeek),
    FOREIGN KEY (BarberID) REFERENCES Admin(BarberID)
);

CREATE TABLE Products (
    ProductID INT(11) NOT NULL AUTO_INCREMENT,
    Name VARCHAR(100) NOT NULL,
    Price DECIMAL(10,2) NOT NULL,
    Category VARCHAR(50) NOT NULL,
    Stock INT(11) NOT NULL,
    ImgUrl VARCHAR(255) DEFAULT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (ProductID)
);

CREATE TABLE Cart (
    CartID INT(11) NOT NULL AUTO_INCREMENT,
    UserID INT(11) NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (CartID),
    FOREIGN KEY (UserID) REFERENCES User(UserID)
);

CREATE TABLE CartItems (
    CartItemID INT(11) NOT NULL AUTO_INCREMENT,
    CartID INT(11) NOT NULL,
    ProductID INT(11) NOT NULL,
    Quantity INT(11) NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (CartItemID),
    FOREIGN KEY (CartID) REFERENCES Cart(CartID),
    FOREIGN KEY (ProductID) REFERENCES Products(ProductID)
);

CREATE TABLE Orders (
    OrderID INT(11) NOT NULL AUTO_INCREMENT,
    UserID INT(11) NOT NULL,
    TotalPrice DECIMAL(10,2) NOT NULL,
    Status VARCHAR(50) NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (OrderID),
    FOREIGN KEY (UserID) REFERENCES User(UserID)
);

CREATE TABLE OrderItems (
    OrderItemID INT(11) NOT NULL AUTO_INCREMENT,
    OrderID INT(11) NOT NULL,
    ProductID INT(11) NOT NULL,
    Quantity INT(11) NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (OrderItemID),
    FOREIGN KEY (OrderID) REFERENCES Orders(OrderID),
    FOREIGN KEY (ProductID) REFERENCES Products(ProductID)
);

CREATE TABLE Reviews (
    ReviewID INT(11) NOT NULL AUTO_INCREMENT,
    UserID INT(11) NOT NULL,
    ProductID INT(11) NOT NULL,
    Rating INT(11) NOT NULL,
    Comment TEXT DEFAULT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (ReviewID),
    FOREIGN KEY (UserID) REFERENCES User(UserID),
    FOREIGN KEY (ProductID) REFERENCES Products(ProductID)
);

CREATE TABLE Appointment (
    AppointmentID INT(11) NOT NULL AUTO_INCREMENT,
    UserID INT(11) NOT NULL,
    BarberID INT(11) NOT NULL,
    ReviewID INT(11) DEFAULT NULL,
    ForName VARCHAR(100) NOT NULL,
    ForAge INT(11) NOT NULL,
    Type VARCHAR(50) NOT NULL,
    Time DATETIME NOT NULL,
    Duration INT(11) NOT NULL,
    Status VARCHAR(50) NOT NULL,
    Cost DECIMAL(10,2) NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (AppointmentID),
    FOREIGN KEY (UserID) REFERENCES User(UserID),
    FOREIGN KEY (BarberID) REFERENCES Barber(BarberID),
    FOREIGN KEY (ReviewID) REFERENCES Reviews(ReviewID)
);

CREATE TABLE Contact (
    ContactID INT(11) NOT NULL AUTO_INCREMENT,
    UserID INT(11) DEFAULT NULL,
    Message TEXT NOT NULL,
    ContactInfo VARCHAR(100) NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsDeleted TINYINT(1) DEFAULT 0,
    PRIMARY KEY (ContactID),
    FOREIGN KEY (UserID) REFERENCES User(UserID)
);
